# パッケージ・マネージャ

筆者: 海老原 賢次（kenji.ebihara@jrits.ricoh.co.jp）  
作成日: 2021-08-18  
更新履歴:

- 2021-08-18: 新規作成

---

## 概要

Webアプリケーションに限らず、システム開発では多くのOSS（だけではないですが）ライブラリを利用することが多いです。

以前は、ブラウザでWebサイトからソースやバイナリのファイルをダウンロードしてプロジェクト内にコピーしていました。

しかし、この方法では下記の問題があります。

- Gitなどの構成管理には、OSSライブラリを履歴管理する必要はないが、入れない場合各開発者がダウンロードする必要がある。その場合バージョンを合わせることやライブラリの数が増えると単純作業でも手間が大変になる。
- ライブラリが依存している他のライブラリがある場合、関係性を把握して入れないといけない。
- 脆弱性の修正等のバージョンアップを利用しているライブラリのサイトを巡回して確認しないといけない。
- 開発環境で利用するツール類も同様で、特にプロジェクトごとに使用するバージョンが異なる場合などは困難となる。

このような問題を解決するため、システム開発ではパッケージマネージャを利用するのが、ほぼ必須です。

## npm

JavaScriptの開発では、パッケージマネージャとして npm を使います。

npm は node.js の公式のパッケージマネージャで、node.js とセットでインストールされます。（Windows の場合）

[Node.js](https://nodejs.org/ja/)

node.js をインストールして、実際に試してみましょう。

プロジェクトのソースフォルダを見立てた、空のフォルダを用意してください。コンソールでここを開いてください。

npm では、ルートに package.json という設定のためのファイルが必要です。ここには、プロジェクトの名前やバージョン、ライセンス情報、使用するライブラリなどの情報を記載します。

これは、npm init のコマンドで作成することができます。コンソールで実行しましょう。

いくつか質問されますが、とりあえず全て Enter キーを押していきましょう。

package.json ファイルができたと思います。これを開くと、先程質問された内容を JSON で書かれています。

続けて React をインストールしてみます。コンソールで、`npm install react` を実行します。

package.json に、dependencies が追加され、そこに react とバージョンの表示があります。

フォルダには、node_modules が作成され、その中に react と他のフォルダが見えます。

先程のコマンドで、React とそれに関連するライブラリがダウンロードされ、node_modules に展開されました。

では、node_modules をフォルダごと削除して、`npm install` を実行してみてください。

再び node_modules が作成され、そのなかに先程と同じ react と他のフォルダが見えます。

node_modules にはこのように npm でインストールされたライブラリなどのパッケージが入ります。`npm install xxxx` で package.json にインストールしたパッケージが記載され、`npm install` で、package.json の中を参照しここにあるパッケージをダウンロードしてくれます。

よって、Git には、このフォルダは対象外として入れないようにし、他の開発者は `npm install` するだけで、同じライブラリを用意することができます。

他にも、パッケージをバージョンアップ・削除したり、依存関係を調べたり、脆弱性の報告されているバージョンのものを使用していないかチェックするなどのコマンドがあります。

どのようなパッケージがあるかは、`npm search` コマンドでも良いですが、公式サイトで検索することをおすすめします。ここでは、Readme のドキュメント、更新頻度、利用者数などが確認でき、パッケージの採用の判断に必要な情報があります。

[npm](https://www.npmjs.com/)

開発環境で使用する、ESLint や TypeScript などのツールも npm で入れます。その場合は、`npm install -D eslint` とします。実行してみましょう。

package.json に devDependencies が追加され、そこに eslint が書かれています。これは、実行環境に必要なものではなく、開発環境のみで必要なもの、と区別するためのものです。

## yarn

yarn は、非公式のパッケージマネージャで、npm が不便なところとより使いやすくする目的で作られたものです。npm と互換性があります。package.json もそのまま使えるので、単純にコマンドを置き換えることが可能です。(コマンド名は異なります)

```
yarn add react
yarn add -D eslint
```

ただ、npm のバージョンアップに伴い、その弱点がなくなってきているので、yarn の利点は薄くなっていますが、多くのプロジェクトで使われており、OSSの公式のドキュメントでも yarn で説明しているところも多いです。

個人的には、ほんの少しの利便性の差で yarn の方を好みます。ただ、npm で動いているプロジェクトを無理に yarn に変更するほどのものではないですね。

## npm スクリプト

npm では簡易なタスクランナーの機能があります。ここに、独自のコマンド名とそのシェルコマンドを定義できます。

`npm init`したときに、scripts に test というのがありますが、これになります。

`npm test` を実行すると、ここに書かれたシェルコマンドが実行されます。

TypeScript を コンパイルするときなど、対象フォルダを空にして、TypeScript のコマンドを実行するなど、一連のコマンドをいちいち打つのが面倒です。そのようなときに、それをここに定義して、簡単に間違いなく実行できるようにしておくと、効率が上がります。

また、ある npm script の前に別の npm script を実行するなどの連携もできます。

[Node.jsユーザーなら押さえておきたいnpm-scriptsのタスク実行方法まとめ - ICS MEDIA](https://ics.media/entry/12226/)

[今まで知らずにいたnpmスクリプトでできる3つのこと](https://www.twilio.com/blog/npm-scripts-jp)

yarn でも `yarn test` のように実行できます。

npm もで、yarn でも、それぞれで用意されているコマンド（install, add など）と重複しないようにします。重複する場合は、`yarn run install` とすることで実行することはできますが、煩雑なだけなのでできるだけ避けましょう。
